let countryFeatureGroup,myMap;function success(t){const a=t.coords;console.log("Your current position is:"),console.log(`Latitude : ${a.latitude}`),console.log(`Longitude: ${a.longitude}`),console.log(`More or less ${a.accuracy} meters.`),initPage(a.latitude,a.longitude)}function error(t){console.warn(`ERROR(${t.code}): ${t.message}`)}function getUserLocIso(t,a){return new Promise((n,e)=>{$.ajax({url:"./php/getIsoCode.php",type:"POST",dataType:"json",data:{lat:t,lng:a},success:function(t){console.log(t),n(t.data)},error:function(t,a,n){alert("The following error occured: "+t.status+" "+a)}})})}function getCountryInfo(t){return new Promise((a,n)=>{$.ajax({url:"./php/getCountryInfo.php",type:"POST",dataType:"json",data:{lang:"en",country:t},success:function(t){console.log(t);let n={continent:t.data[0].continent,capital:t.data[0].capital,languages:t.data[0].languages,population:t.data[0].population,areaInSqKm:t.data[0].areaInSqKm,currencyCode:t.data[0].currencyCode,countryName:t.data[0].countryName};a(n)},error:function(t,a,n){alert("The following error occured: "+t.status+" "+a)}})})}function getBorder(t){return new Promise((a,n)=>{$.ajax({url:"./php/findBorder.php",type:"POST",dataType:"json",data:{isoCode:t},success:function(t){console.log(t.data),console.log("getBorder result type is below"),console.log(typeof t.data),a(t.data)},error:function(t,a,n){alert("The following error occured: "+t.status+" "+a)}})})}function plotBorder(t){countryFeatureGroup&&myMap.removeLayer(countryFeatureGroup),countryFeatureGroup=L.geoJSON(t).addTo(myMap),myMap.fitBounds(countryFeatureGroup.getBounds())}async function initPage(t,a){console.log("Starting....");let n=await getUserLocIso(t,a);console.log("This wont run until async thing done"),console.log(n);let e=await getCountryInfo(n);console.log(e.capital),console.log(e.languages),$("#capitalCell").html(e.capital),$("#languagesCell").html(e.languages),$("#areaCell").html(e.areaInSqKm),$("#populationCell").html(e.population),$("#currencyCell").html(e.currencyCode),$("#countryNameCell").html(e.countryName);let o=await getBorder(n);console.log("Border geoJson logged below"),console.log(o),plotBorder(o),$("#countrySelect").val(n),$("#countryFlag").attr("src",`https://www.countryflags.io/${n}/flat/64.png`),$("#myModal").modal({backdrop:!1})}async function changeBorder(){const t=$("#countrySelect").val();let a=await getCountryInfo(t);$("#capitalCell").html(a.capital),$("#languagesCell").html(a.languages),$("#areaCell").html(a.areaInSqKm),$("#populationCell").html(a.population),$("#currencyCell").html(a.currencyCode),$("#countryNameCell").html(a.countryName),plotBorder(await getBorder(t)),$("#countryFlag").attr("src",`https://www.countryflags.io/${t}/flat/64.png`),$("#myModal").modal({backdrop:!1})}function getWiki(){const t=myMap.getCenter();$.ajax({url:"./php/getWiki.php",type:"POST",dataType:"json",data:{lat:t.lat,lng:t.lng},success:function(t){if(console.log(t),"ok"==t.status.name){const a=L.ExtraMarkers.icon({icon:"fa-wikipedia-w",iconColer:"white",markerColor:"black",shape:"square",prefix:"fa"});let n=[];console.log("Result length is "),console.log(t.data.length);let e=L.markerClusterGroup();if(t.data.length>0){for(i=0;i<t.data.length;i++){const o=t.data[i].lat,r=t.data[i].lng;n[i]=[o,r];const l=`<h4>${t.data[i].title}</h4>\n\t\t\t\t\t\t<p>${t.data[i].summary}</p>\n\t\t\t\t\t\t<a href="https://${t.data[i].wikipediaUrl}">View Wikipedia article</a>`,d=L.marker([o,r],{icon:a});d.bindPopup(l),d.on("click",onClick),e.addLayer(d)}myMap.addLayer(e),myMap.flyToBounds(n,{padding:[30,30]})}0==t.data.length&&$("#noWikiModal").modal({backdrop:!1})}},error:function(t,a,n){console.log(a)}})}function getEarthquakes(){const t=myMap.getCenter();$.ajax({url:"./php/getEarthquakes.php",type:"POST",dataType:"json",data:{north:t.lat+4,south:t.lat-4,east:t.lng+4,west:t.lng-4},success:function(t){if(console.log(t),"ok"==t.status.name){const a=L.ExtraMarkers.icon({icon:"fa-globe",iconColer:"white",markerColor:"black",shape:"square",prefix:"fa"});let n=[],e=L.markerClusterGroup();if(t.data.length>0){for(i=0;i<t.data.length;i++){const o=t.data[i].lat,r=t.data[i].lng,l=t.data[i].datetime.substring(0,10),d=t.data[i].datetime.substring(11,19);n[i]=[o,r];const s=L.marker([o,r],{icon:a}),c=`<h5>Earthquake information</h5>\n\t\t\t\t\t\t<table class="table">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>Date: </td>\n\t\t\t\t\t\t\t\t<td>${l}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>Time: </td>\n\t\t\t\t\t\t\t\t<td>${d}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>Depth: </td>\n\t\t\t\t\t\t\t\t<td>${t.data[i].depth}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>Magnitude: </td>\n\t\t\t\t\t\t\t\t<td>${t.data[i].magnitude}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>`;s.bindPopup(c),s.on("click",onClick),e.addLayer(s)}myMap.addLayer(e),myMap.flyToBounds(n,{padding:[30,30]})}0==t.data.length&&$("#noEarthquakesModal").modal({backdrop:!1})}},error:function(t,a,n){console.log(a)}})}function onClick(t){t.target.getPopup().openOn(myMap)}function getPOI(){const t=myMap.getCenter();$.ajax({url:"./php/getPOI.php",type:"POST",dataType:"json",data:{box:`{\n\t\t\t\t"boundingBox": {\n\t\t\t\t\t"ul": {\n\t\t\t\t\t\t"lat": ${t.lat+2},\n\t\t\t\t\t\t"lng": ${t.lng+2}\n\t\t\t\t\t},\n\t\t\t\t\t"lr": {\n\t\t\t\t\t\t"lat": ${t.lat-2},\n\t\t\t\t\t\t"lng": ${t.lng-2}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t"options": {}\n\t\t\t}`},success:function(t){if(console.log(t),"ok"==t.status.name){const a=L.ExtraMarkers.icon({icon:"fa-map-marker-alt",iconColer:"white",markerColor:"black",shape:"square",prefix:"fa"});let n=[],e=L.markerClusterGroup();if(t.data.length>0){for(i=0;i<t.data.length;i++){const o=t.data[i].shapePoints[0],r=t.data[i].shapePoints[1],l=t.data[i].name,d=t.data[i].fields.address,s=t.data[i].fields.city,c=t.data[i].fields.phone;let p;p=d&&s&&c?`<h5>Point of interest</h5>\n\t\t\t\t\t\t\t\t<table class="table">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>Name: </td>\n\t\t\t\t\t\t\t\t\t\t<td>${l}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>Address: </td>\n\t\t\t\t\t\t\t\t\t\t<td>${d}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>City: </td>\n\t\t\t\t\t\t\t\t\t\t<td>${s}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>Phone: </td>\n\t\t\t\t\t\t\t\t\t\t<td>${c}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>Latitude: </td>\n\t\t\t\t\t\t\t\t\t\t<td>${o}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>Longitude: </td>\n\t\t\t\t\t\t\t\t\t\t<td>${r}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>`:`<h5>${l}</h5>\n\t\t\t\t\t\t\t<p>Latitude: ${o}</p>\n\t\t\t\t\t\t\t<p>Longitude: ${r}</p>\n\t\t\t\t\t\t\t<p>That's all the information we have about this point of interest. Places in North America have more information.</p>`,n[i]=[o,r];const u=L.marker([o,r],{icon:a});u.bindPopup(p).openPopup(),u.on("click",onClick),e.addLayer(u)}myMap.addLayer(e),myMap.flyToBounds(n,{padding:[30,30]})}0==t.data.length&&$("#noPOIsModal").modal({backdrop:!1})}},error:function(t,a,n){console.log(a),$("#noPOIsModal").modal({backdrop:!1})}})}function onMapClick(t){$.ajax({url:"./php/getWeather.php",type:"POST",dataType:"json",data:{lat:t.latlng.lat,lng:t.latlng.lng},success:function(a){console.log(a);const n=`<table>\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Metric</th>\n\t\t\t\t\t\t\t<th>Observation</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Latitude</td>\n\t\t\t\t\t\t\t<td>${t.latlng.lat.toFixed(2).toString()}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Longitude</td>\n\t\t\t\t\t\t\t<td>${t.latlng.lng.toFixed(2).toString()}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Clouds</td>\n\t\t\t\t\t\t\t<td>${a.data.clouds}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Temperature</td>\n\t\t\t\t\t\t\t<td>${a.data.temperature} <sup>o</sup>C</td>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Humidity</td>\n\t\t\t\t\t\t\t<td>${a.data.humidity}%</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Wind speed</td>\n\t\t\t\t\t\t\t<td>${a.data.windSpeed}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>`;"ok"==a.status.name&&popup.setLatLng(t.latlng).setContent(n).openOn(myMap)},error:function(a,n,e){popup.setLatLng(t.latlng).setContent("<p>Sorry, no weather info at this location. Try clicking somewhere else.</p>").openOn(myMap)}})}$(window).on("load",function(){$("#preloader").length&&$("#preloader").delay(100).fadeOut("slow",function(){$(this).remove()}),$.ajax({url:"./php/parseJson.php",dataType:"json",success:function(t){for(console.log(t),i=0;i<t.data.length;i++)$("#countrySelect").append($("<option>",{value:t.data[i].isoCode,text:t.data[i].name+" - "+t.data[i].isoCode}))},error:function(t,a,n){alert("The following error occured: "+t.status+" "+a)}}),myMap=L.map("mapid");L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:3,noWrap:!0,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(myMap);const t=L.latLng(-89.98155760646617,-180),a=L.latLng(89.99346179538875,180),n=L.latLngBounds(t,a);myMap.setMaxBounds(n),myMap.on("drag",function(){myMap.panInsideBounds(n,{animate:!1})}),L.easyButton("fa-info",async function(t,a){plotBorder(await getBorder($("#countrySelect").val())),$("#myModal").modal({backdrop:!1})},"Show country info").addTo(myMap),L.easyButton("fa-wikipedia-w",getWiki,"Find Wiki articles near map center").addTo(myMap),L.easyButton("fa-globe",getEarthquakes,"Find earthquakes near map center").addTo(myMap),L.easyButton("fa-map-marker-alt",getPOI,"Find points of interest near map center").addTo(myMap);navigator.geolocation.getCurrentPosition(success,error,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}),popup=L.popup(),myMap.on("click",onMapClick),$("#countrySelect").on("change",changeBorder)});